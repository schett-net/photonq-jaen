{"version":3,"file":"7701-292d9439eca4312875dd.js","mappings":"uUAAA,SAASA,EAAgBC,EAAKC,EAAKC,GAYjC,OAXID,KAAOD,EACTG,OAAOC,eAAeJ,EAAKC,EAAK,CAC9BC,MAAOA,EACPG,YAAY,EACZC,cAAc,EACdC,UAAU,IAGZP,EAAIC,GAAOC,EAGNF,CACT,CAEA,SAASQ,EAAcC,GACrB,IAAK,IAAIC,EAAI,EAAGA,EAAIC,UAAUC,OAAQF,IAAK,CACzC,IAAIG,EAAyB,MAAhBF,UAAUD,GAAaC,UAAUD,GAAK,CAAC,EAChDI,EAAUX,OAAOY,KAAKF,GAEkB,mBAAjCV,OAAOa,wBAChBF,EAAUA,EAAQG,OAAOd,OAAOa,sBAAsBH,GAAQK,QAAO,SAAUC,GAC7E,OAAOhB,OAAOiB,yBAAyBP,EAAQM,GAAKd,UACtD,MAGFS,EAAQO,SAAQ,SAAUpB,GACxBF,EAAgBU,EAAQR,EAAKY,EAAOZ,GACtC,GACF,CAEA,OAAOQ,CACT,CAoBA,SAASa,EAAmBb,EAAQI,GAWlC,OAVAA,EAAmB,MAAVA,EAAiBA,EAAS,CAAC,EAEhCV,OAAOoB,0BACTpB,OAAOqB,iBAAiBf,EAAQN,OAAOoB,0BAA0BV,IAtBrE,SAAiBY,EAAQC,GACvB,IAAIX,EAAOZ,OAAOY,KAAKU,GAEvB,GAAItB,OAAOa,sBAAuB,CAChC,IAAIW,EAAUxB,OAAOa,sBAAsBS,GAEvCC,IACFC,EAAUA,EAAQT,QAAO,SAAUC,GACjC,OAAOhB,OAAOiB,yBAAyBK,EAAQN,GAAKd,UACtD,KAGFU,EAAKa,KAAKC,MAAMd,EAAMY,EACxB,CAEA,OAAOZ,CACT,CAQID,CAAQX,OAAOU,IAASQ,SAAQ,SAAUpB,GACxCE,OAAOC,eAAeK,EAAQR,EAAKE,OAAOiB,yBAAyBP,EAAQZ,GAC7E,IAGKQ,CACT,CAQA,IAAIqB,EAAQ,CACVC,KAAM,CAAC,OAAQ,SACfC,KAAM,CAAC,OAAQ,UAEV,SAASC,EAAkBC,EAAQC,GACxC,IAAIC,GAAc,IAAAC,gBAAe,CAC/BC,QAASJ,EACTK,QAAS,CACPT,MAAOA,KAGPU,GAAe,IAAAC,iBAAgB,CACjCL,YAAaA,EAAYM,MACzBH,QAAS,CACPT,MAAOA,KAIX,OADAa,EAAyBR,EAAKC,EAAYM,MAAOF,EAAaE,OACvD,CACLN,YAAaA,EAAYM,MACzBF,aAAcA,EAAaE,MAE/B,CACO,SAASC,EAAyBR,EAAKC,EAAaI,GACzDL,EAAIS,OAAO,KAAmBR,EAAad,EAAmBd,EAAc,CAAC,EAAG,MAAiB,CAC/FqC,OAAqC,IAA7B,QAEVV,EAAIS,OAAO,KAA2BJ,EAAclB,EAAmBd,EAAc,CAAC,EAAG,MAAiB,CACxGqC,OAA6C,IAArC,OAEZ,CACO,SAASC,EAAkBC,GAChC,IAAIX,EAAcW,EAAIC,QAAQ,MAC1BR,EAAeO,EAAIC,QAAQ,MAC3BC,GAAM,IAAAC,QAAOd,GAAaa,IAE9B,IAAKA,EACH,MAAM,IAAIE,MAAM,oCAGlB,MAAO,CACLjB,OAAQe,EACRb,YAAaA,EACbI,aAAcA,EAElB,CACO,SAASY,EAAsBC,GACpC,IAGIC,EAHAC,EAAcF,EAAME,YACpBnB,EAAciB,EAAMjB,YACpBoB,GAAQ,IAAAN,QAAOd,GAIjBkB,EADEG,MAAMC,QAAQF,EAAM1B,OACN0B,EAAM1B,MAEN0B,EAAM1B,MAAMyB,GAG9B,IAMII,GANM,IAAAtB,gBAAe,CACvBC,QAASkB,EAAMP,IACfV,QAAS,CACPT,MAAOwB,KAGkBZ,MAC7B,MAAO,UAAUzB,OAAO0C,EAC1B,C","sources":["webpack://my-gatsby-site/./node_modules/@snek-functions/origin/dist/helper/auth.js"],"sourcesContent":["function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}\n\nfunction _objectSpread(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n    var ownKeys = Object.keys(source);\n\n    if (typeof Object.getOwnPropertySymbols === \"function\") {\n      ownKeys = ownKeys.concat(Object.getOwnPropertySymbols(source).filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(source, sym).enumerable;\n      }));\n    }\n\n    ownKeys.forEach(function (key) {\n      _defineProperty(target, key, source[key]);\n    });\n  }\n\n  return target;\n}\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n\n    if (enumerableOnly) {\n      symbols = symbols.filter(function (sym) {\n        return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n      });\n    }\n\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nfunction _objectSpreadProps(target, source) {\n  source = source != null ? source : {};\n\n  if (Object.getOwnPropertyDescriptors) {\n    Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n  } else {\n    ownKeys(Object(source)).forEach(function (key) {\n      Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n    });\n  }\n\n  return target;\n}\n\nimport { COOKIE_OPTIONS, LOGIN_REFRESH_TOKEN_COOKIE_MAX_AGE, LOGIN_TOKEN_COOKIE_MAX_AGE, REFRESH_TOKEN_COOKIE_NAME, TOKEN_COOKIE_NAME } from \"../constants.js\";\nimport { newAccessToken, newRefreshToken, verify } from \"../internal/token/factory.js\";\n/**\n * Temporary scope until real auth2 is implemented.\n */\n\nvar scope = {\n  res1: [\"read\", \"write\"],\n  res2: [\"read\", \"write\"]\n};\nexport function setAuthentication(userId, res) {\n  var accessToken = newAccessToken({\n    subject: userId,\n    payload: {\n      scope: scope\n    }\n  });\n  var refreshToken = newRefreshToken({\n    accessToken: accessToken.token,\n    payload: {\n      scope: scope\n    }\n  });\n  setAuthenticationCookies(res, accessToken.token, refreshToken.token);\n  return {\n    accessToken: accessToken.token,\n    refreshToken: refreshToken.token\n  };\n}\nexport function setAuthenticationCookies(res, accessToken, refreshToken) {\n  res.cookie(TOKEN_COOKIE_NAME, accessToken, _objectSpreadProps(_objectSpread({}, COOKIE_OPTIONS), {\n    maxAge: LOGIN_TOKEN_COOKIE_MAX_AGE * 1000\n  }));\n  res.cookie(REFRESH_TOKEN_COOKIE_NAME, refreshToken, _objectSpreadProps(_objectSpread({}, COOKIE_OPTIONS), {\n    maxAge: LOGIN_REFRESH_TOKEN_COOKIE_MAX_AGE * 1000\n  }));\n}\nexport function getAuthentication(req) {\n  var accessToken = req.cookies[TOKEN_COOKIE_NAME];\n  var refreshToken = req.cookies[REFRESH_TOKEN_COOKIE_NAME];\n  var sub = verify(accessToken).sub;\n\n  if (!sub) {\n    throw new Error(\"No subject found in access token\");\n  }\n\n  return {\n    userId: sub,\n    accessToken: accessToken,\n    refreshToken: refreshToken\n  };\n}\nexport function generateInternalToken(param) {\n  var ressourceId = param.ressourceId,\n      accessToken = param.accessToken;\n  var parts = verify(accessToken);\n  var internalScope;\n\n  if (Array.isArray(parts.scope)) {\n    internalScope = parts.scope;\n  } else {\n    internalScope = parts.scope[ressourceId];\n  }\n\n  var ref = newAccessToken({\n    subject: parts.sub,\n    payload: {\n      scope: internalScope\n    }\n  }),\n      limitedAccessToken = ref.token;\n  return \"Bearer \".concat(limitedAccessToken);\n}"],"names":["_defineProperty","obj","key","value","Object","defineProperty","enumerable","configurable","writable","_objectSpread","target","i","arguments","length","source","ownKeys","keys","getOwnPropertySymbols","concat","filter","sym","getOwnPropertyDescriptor","forEach","_objectSpreadProps","getOwnPropertyDescriptors","defineProperties","object","enumerableOnly","symbols","push","apply","scope","res1","res2","setAuthentication","userId","res","accessToken","newAccessToken","subject","payload","refreshToken","newRefreshToken","token","setAuthenticationCookies","cookie","maxAge","getAuthentication","req","cookies","sub","verify","Error","generateInternalToken","param","internalScope","ressourceId","parts","Array","isArray","limitedAccessToken"],"sourceRoot":""}